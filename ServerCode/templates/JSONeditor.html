<link rel="stylesheet" href="{{ url_for('static',filename='styles.css') }}">

<html>

<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">

	<link href="static/jsoneditor/dist/jsoneditor.min.css" rel="stylesheet" type="text/css">
	<script src="static/jsoneditor/dist/jsoneditor.min.js"></script>
	<script>
		function Get(yourUrl) {
			var Httpreq = new XMLHttpRequest(); // a new request
			Httpreq.open("GET", yourUrl, false);
			Httpreq.send(null);
			return Httpreq.responseText;
		}
	</script>
</head>

<body>
	<div class="table-title">
		<h3>Waveform Manager</h3>
	</div>
	<div id="container" style='height:500px;'>

		<div id='power' class="table-title"></div>
		<div id="jsoneditor" class='content'></div>

		<div id="buttons">
			<div class="table-title">
				<h3>Actions <select id="channel">
					<option value="0">Channel 0</option>
					<option value="1">Channel 1</option>
				</select></h3>
			</div>
			<table class="table-fill">
				<tbody class="table-hover">
					<tr>
						<td class="text-center button" onclick="buttonPress('update')">Update</td>
					</tr>
				</tbody>
			</table>
			<table class="table-fill">
				<tbody class="table-hover">
					<tr>
						<td class="text-center button" onclick="buttonPress('update')">Update</td>
						<td class="text-center button" onclick="buttonPress('randomizePhases')">Randomize Phase</td>
						<td class="text-center button" onclick="buttonPress('resetAmplitudes')">Reset All Amplitudes</td>
					</tr>
				</tbody>
			</table>
		</div>
	</div>

	<script>
		document.getElementById("power").innerHTML = "<h3>Power = " + Get('/action/getPower/0') + "dbm "+ Get('/action/getPower/1') +"dbm</h3>";
		// create the editor

		var container = document.getElementById("jsoneditor");
		var options = {};
		var editor = new JSONEditor(container, options);
		var channelNum = document.getElementById("channel");

		// set json
		var json = JSON.parse(Get('/action/getWaveformArguments/0'));
		editor.set(json);
		editor.expandAll();

		// get json
		var json = editor.get();

		function buttonPress(clicked) {
			alert(options.value)
			var xhr = new XMLHttpRequest();
			xhr.open('POST', "/action/" + clicked + "/" + channelNum.value);
			xhr.send(JSON.stringify(editor.get()));
			xhr.onloadend = function() {
				document.getElementById("power").innerHTML = "<h3>Power = " + Get('/action/getPower/0') + "dbm "+ Get('/action/getPower/1') +"dbm</h3>";
				var json = JSON.parse(Get('/action/getWaveformArguments/0'));
				editor.set(json);
				editor.expandAll();
			};
		}
	</script>
</body>

</html>
